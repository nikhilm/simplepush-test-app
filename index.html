<!DOCTYPE html>
<html>

  <head>
    <meta charset="utf-8">
    <meta http-equiv="pragma" content="no-cache">
    <title>Push ServiceWorkers</title>

    <link rel="stylesheet" href="/assets/v1/404.css">

    <script>
        //var w = new Worker("service.j");
      if ("serviceWorker" in navigator) {
        navigator.serviceWorker.register("service.js").then(function(worker) {
          console.log("Successfully registered service worker.", worker);
        });
      } else {
        alert("How dare you not have Service Workers!");
      }

      function updateNotifications() {

        function createRegistrationUI(registration) {
          var button = document.createElement("button");
          var t   = document.createTextNode("Unregister");
          button.appendChild(t);

          button.addEventListener('click', function() {
              navigator.pushRegistrationManager.unregister()
              .then(function(e) {updateNotifications();},
                    function(e) {alert("unregister failed");});
          }, false);


          var h = document.createElement("p");
          t = document.createTextNode(registration);
          h.appendChild(t);


          var div = document.createElement("div");
          div.appendChild(button);
          div.appendChild(h);

          return div;
        }

        document.getElementById("registrations").innerHTML = "";

        navigator.pushRegistrationManager.isRegistered()
          .then(function(is) {
            if (is) {
              navigator.pushRegistrationManager.register()
                .then(function(reg) {
                  var div = createRegistrationUI(reg);
                  document.getElementById("registrations").appendChild(div);
                });
            }
          });
      }

      function register() {
        var req = navigator.pushRegistrationManager.register();

        req.then(function() {
          updateNotifications();
        }, function(e) {
          alert("Registration error");
        });
      }

    </script>
  </head>

  <body onload="updateNotifications();">
    <p>Push Notifications</p>

    <button onclick="register();">Register!</button>

    <p>Registrations</p>


    <div id='registrations'>
    </div>

    <!--<script src="/data.js"> </script>-->
  </body>

</html>
